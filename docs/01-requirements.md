# 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名

gmn (旧称: geminimini)

### 1.2 プロジェクトの目的

Google Gemini CLI の機能を Go 言語で再実装し、高速・軽量な CLI ツールを提供する。
非対話型の高速実行と、対話型のリッチなTUIの両方をサポート。

### 1.3 背景

- 公式 Gemini CLI は Node.js 製で起動が遅く、メモリ消費が大きい
- 非対話型（スクリプト/自動化）用途では高速起動が重要
- 対話型用途でもCodex CLIのようなモダンなTUIが求められている
- ワンバイナリで配布可能な軽量ツールが求められている

### 1.4 スコープ

#### スコープ内

- Gemini API への非対話型アクセス（高速起動）
- 対話型チャットモード（リッチTUI）
- ビルトインツール（ファイル操作、Web検索、シェル実行）
- 公式 CLI の OAuth 認証トークン流用
- MCP (Model Context Protocol) クライアント
- `~/.gemini/settings.json` 互換の設定読み込み
- 複数の出力形式（text, json, stream-json）
- YOLO モード（確認スキップ）

#### スコープ外

- 新規認証フロー（OAuth ブラウザ認証）
- API Key 認証
- Vertex AI 認証
- IDE 連携機能

## 2. ステークホルダー

| ステークホルダー   | 役割                 | 関心事                                         |
| ------------------ | -------------------- | ---------------------------------------------- |
| 開発者（ユーザー） | エンドユーザー       | 高速起動、スクリプト統合、対話型開発、MCP 活用 |
| Google             | 元プロジェクト提供者 | ライセンス遵守、API 利用規約遵守               |

## 3. ユースケース

### UC-1: プロンプト実行（非対話型）

- アクター: 開発者
- 概要: コマンドラインからプロンプトを送信し、結果を取得する
- 前提条件: 公式 Gemini CLI で認証済み
- 基本フロー:
  1. ユーザーが `gmn "プロンプト"` を実行
  2. システムが認証トークンを読み込む
  3. システムが Gemini API にリクエストを送信
  4. システムが結果を標準出力に出力

### UC-2: 対話型チャット

- アクター: 開発者
- 概要: 対話型セッションでGeminiと会話し、ツールを利用する
- 前提条件: 公式 Gemini CLI で認証済み
- 基本フロー:
  1. ユーザーが `gmn chat` を実行
  2. システムがリッチなTUIヘッダーを表示
  3. ユーザーがプロンプトを入力
  4. システムがGeminiにリクエストを送信（スピナー表示）
  5. 必要に応じてツールを実行（確認プロンプト表示）
  6. 結果をストリーミング表示
  7. セッション終了時にトークン使用統計を表示

### UC-3: パイプライン統合

- アクター: 開発者
- 概要: 他のコマンドの出力をパイプで受け取り処理する
- 基本フロー:
  1. ユーザーが `cat file.txt | gmn "要約して"` を実行
  2. システムが標準入力を読み込む
  3. システムがプロンプトと入力を結合して送信
  4. システムが結果を出力

### UC-4: MCP ツール利用

- アクター: 開発者
- 概要: MCP サーバー経由で外部ツールを呼び出す
- 前提条件: `~/.gemini/settings.json` に MCP サーバーが設定済み
- 基本フロー:
  1. ユーザーがプロンプトを実行
  2. モデルがツール呼び出しを要求
  3. システムが MCP サーバーに接続しツールを実行
  4. システムが結果をモデルに返却
  5. モデルが最終回答を生成

### UC-5: JSON 出力

- アクター: 開発者/スクリプト
- 概要: 機械処理用に構造化された出力を得る
- 基本フロー:
  1. ユーザーが `-o json` オプションで実行
  2. システムが JSON 形式で結果を出力
  3. 後続のスクリプトが JSON をパース

### UC-6: YOLOモード

- アクター: 開発者
- 概要: 確認プロンプトをスキップして自動実行
- 基本フロー:
  1. ユーザーが `gmn chat --yolo` を実行
  2. ツール実行時に確認プロンプトが表示されない
  3. すべてのツールが自動的に実行される

## 4. 制約条件

### 4.1 技術的制約

- Go 1.21 以上
- macOS / Linux / Windows 対応
- 公式 Gemini CLI の認証情報が必要

### 4.2 ライセンス制約

- Apache License 2.0 を適用
- 派生物であることを明示（NOTICE ファイル）
- 元プロジェクトへの帰属を維持

### 4.3 API 制約

- Google Gemini API の利用規約に従う
- 無料枠: 60 リクエスト/分、1,000 リクエスト/日

## 5. 前提条件

- ユーザーは公式 Gemini CLI (`npm install -g @google/gemini-cli`) をインストール済み
- ユーザーは公式 CLI で Google アカウント認証を完了済み
- `~/.gemini/` ディレクトリに認証情報が存在

## 6. 成功基準

| 基準                | 目標値                 |
| ------------------- | ---------------------- |
| 起動時間            | 100ms 以下（非対話型） |
| バイナリサイズ      | 20MB 以下              |
| メモリ使用量        | 50MB 以下（実行時）    |
| 公式 CLI との互換性 | 設定ファイル 100% 互換 |
| TUI レスポンス      | 即座のスピナー表示     |
